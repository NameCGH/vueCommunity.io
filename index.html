<!doctype html>
<html>
    <head>
        <title>CGH个人博客</title>
        <meta http-equiv="X-UA-Compatible" content="ie=edge,chrome=1">
        <meta name="keywords" content="CGH">
        <meta name="description" content="这个网站是个人博客网站">
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8;">
        <link rel="stylesheet" href="./css/main.css">
    </head>
    <body>
        <header>
            <div id="header">
                <div>
                    <canvas width="200" height="50" id="canvas">不支持canvas显示</canvas>
                </div>
                <div>
                    <ul>
                        <li><a href="">首页</a></li>
                        <li><a href="">在线手册</a></li>
                        <li><a href="">博客笔记</a></li>
                        <li><a href="">Demo</a></li>
                        <li><a href="">项目源码</a></li>
                    </ul>
                </div>
            </div>
        </header>

        <section class="main">
            <div class="content">
                <div class="sidebar">
                    <ul id="sidebar">
                        <li data-type="frame">框架/库</li>
                        <li data-type="template">模块/管理</li>
                        <li data-type="mobile">移动端UI框架</li>
                        <li data-type="webui">Web-UI框架</li>
                        <li data-type="jsframework">JS框架</li>
                        <li data-type="jqframework">Jquery框架</li>
                        <li data-type="css">CSS相关</li>
                        <li data-type="ide">IDE环境</li>
                        <li data-type="tools">在线工具</li>
                        <li data-type="pecialEffects">图形动效</li>
                        <li data-type="gamesframe">游戏框架</li>
                        <li data-type="node">Node相关</li>
                        <li data-type="debug">调试/测试</li>
                        <li data-type="study">在线学习平台</li>
                        <li data-type="forum">社区/论坛</li>
                        <li data-type="blog">博客/团队</li>
                        <li data-type="material">前端素材</li>
                        <li data-type="icon">图标/图库</li>
                        <li data-type="resources">建站资源</li>
                        <li data-type="Design">设计/灵感</li>
                        <li data-type="work">招聘/兼职</li>
                        <li data-type="message">IT资讯</li>
                    </ul>
                </div>
                <div>
                    <div class="lists" id="lists">
                        <div class="list">
                            <div>
                                <h4></h4>
                                <p class="synopsis"></p>
                                <div class="btns">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="page">
                        <ul id="page">
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <script>
            var canvas = document.getElementById("canvas");
            var ctx = canvas.getContext('2d');
            ctx.font="30px 华文行楷";
            var font_style = ctx.createLinearGradient(0,0,200,0);
            font_style.addColorStop(0,"pink");
            font_style.addColorStop(0.5,"skyblue");
            font_style.addColorStop(1,"#7af294");
            ctx.fillStyle = font_style;
            ctx.fillText("博客中心",40,35);



            var ajax = {},pagenumber = 1,nav = "frame";
            if(window.XMLHttpRequest){
                ajax = new XMLHttpRequest();
            }
            else{
                ajax = new ActiveXObject("Microsoft.XMLHTTP");
            }
            
            function postData(sql){
                ajax.open("Post","./api/index.php");
                ajax.setRequestHeader("content-type","application/x-www-form-urlencoded");
                ajax.onreadystatechange = function(res){
                    if(ajax.readyState == 4 && ajax.status == 200){
                        var res = JSON.parse(ajax.response);
                        if(res.static){
                            var str = "", pageStr = "";
                            // 获取到的数据条数，循环将每条数据渲染到页面
                            res.data.forEach(function(val,key){
                                str += '<div class="list"><div><h4>'+val.title+'</h4><p class="synopsis">'+val.text+'</p><div class="btns"><a href="'+val.weblink+'" target="_bank">官网</a><a href="'+val.gitlink+'" target="_bank">GitHub</a></div></div></div>';
                            })
                            document.getElementById("lists").innerHTML = str;


                            for(var i = 1; i <= res.datalength; i++){
                                pageStr += '<li';
                                if(pagenumber == i){
                                    pageStr += ' class="pageActive"';
                                }
                                pageStr += '>'+i+'</li>';
                            }
                            document.getElementById('page').innerHTML = pageStr;

                            var pageChildren = document.getElementById("page").children;
                            for(var x = 0; x < pageChildren.length; x++){
                                (function(number){
                                    pageChildren[number].onclick = function(){
                                        if(number + 1 == pagenumber){
                                            return;
                                        }
                                        pagenumber = number + 1;
                                        postData('action='+nav+'&page='+pagenumber);
                                    }
                                })(x);
                            }
                        }
                        else{
                            document.getElementById('page').innerHTML = "";
                            document.getElementById("lists").innerHTML = "";
                            alert("当前模块暂无数据，敬请期待后续添加！");
                            location.reload();
                        }
                    }
                }
                ajax.send(sql);
            }
            postData('action='+nav+'&page='+pagenumber);
            for(var sidlen = 0;sidlen < document.getElementById('sidebar').children.length; sidlen++){
                (function(sidlen){
                    document.getElementById('sidebar').children[sidlen].onclick = function(){
                        if(this.getAttribute('data-type') == nav){
                            return;
                        }
                        pagenumber = 1;
                        nav = this.getAttribute('data-type');
                        postData('action='+nav+'&page='+pagenumber);
                    }
                })(sidlen);
            }

            // 继续使用打开文件的方法读取json数据
            // 获取网站数据
            // 隐藏ajax请求
        </script>
    </body>
</html>